<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Kuis PAI SD Kelas 3 & 4</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<style>
:root { --primary:#2E8B57; --light:#F0FFF0; --danger:#e74c3c; --white:#fff;}
*{margin:0;padding:0;box-sizing:border-box;font-family:'Segoe UI',sans-serif;}
body{background:var(--light);display:flex;justify-content:center;align-items:center;min-height:100vh;padding:20px;}
.app{background:var(--white);width:100%;max-width:650px;border-radius:12px;box-shadow:0 5px 20px rgba(0,0,0,.2);overflow:hidden;}
header{background:var(--primary);color:#fff;padding:20px;text-align:center;}
.screen{display:none;padding:25px;min-height:400px;}
.screen.active{display:block;}
.form-group{margin-bottom:15px;}
label{font-weight:bold;margin-bottom:5px;display:block;color:var(--primary);}
input,select{width:100%;padding:10px;border:2px solid #ccc;border-radius:8px;}
.btn{width:100%;padding:12px;font-weight:bold;color:#fff;background:var(--primary);border:none;border-radius:8px;margin-top:10px;cursor:pointer;}
.btn-danger{background:var(--danger);}
.question-card{background:#fafafa;padding:18px;border-left:5px solid gold;margin-bottom:15px;border-radius:10px;}
.option{border:2px solid #ccc;padding:12px;border-radius:8px;margin:8px 0;cursor:pointer;}
.option.selected{background:var(--primary);color:#fff;border-color:var(--primary);}
.score-circle{width:140px;height:140px;border-radius:50%;background:var(--primary);color:#fff;display:flex;justify-content:center;align-items:center;font-size:2.5rem;margin:15px auto;}
table{width:100%;border-collapse:collapse;margin-top:10px;}
th,td{border:1px solid #ddd;padding:7px;font-size:.85rem;}
th{background:var(--primary);color:#fff;}
.link{text-align:center;margin-top:10px;font-size:.8rem;}
small{color:red;}
</style>
</head>

<body>
<div class="app">
<header>
    <h2>Kuis PAI SD</h2>
    <p>Kelas 3A, 3B, 4A, 4B</p>
</header>

<!-- LOGIN -->
<div id="login" class="screen active">
    <h3 style="text-align:center;margin-bottom:10px;">Masukkan Data</h3>
    <div class="form-group">
        <label>Nama Siswa</label>
        <input id="studentName" type="text">
    </div>
    <div class="form-group">
        <label>Kelas</label>
        <select id="studentClass">
            <option value="" disabled selected>Pilih Kelas</option>
            <option value="3A">Kelas 3A</option>
            <option value="3B">Kelas 3B</option>
            <option value="4A">Kelas 4A</option>
            <option value="4B">Kelas 4B</option>
        </select>
    </div>
    <small id="loginError" style="display:none;"></small>
    <button class="btn" onclick="startQuiz()">Mulai Kuis</button>
    <div class="link"><a href="#" onclick="openAdmin()">Masuk Guru/Admin</a></div>
</div>

<!-- QUIZ -->
<div id="quiz" class="screen">
    <div style="display:flex;justify-content:space-between;margin-bottom:10px;">
        <span id="progress">Soal 1/10</span>
        <span id="kelasTag" style="font-weight:bold;color:var(--primary);"></span>
    </div>
    <div class="question-card"><div id="questionText"></div></div>
    <div id="options"></div>
    <button id="nextBtn" class="btn" onclick="nextQuestion()" disabled>Selanjutnya</button>
</div>

<!-- RESULT -->
<div id="result" class="screen">
    <h3 style="text-align:center;">Kuis Selesai!</h3>
    <h4 id="nameResult" style="text-align:center;"></h4>
    <div id="scoreBox" class="score-circle"></div>
    <p style="text-align:center;">Nilai sudah direkap</p>
    <button class="btn" onclick="restart()">Kembali ke Awal</button>
</div>

<!-- ADMIN MENU -->
<div id="adminMenu" class="screen">
    <h3 style="text-align:center;">MENU ADMIN</h3>
    <button class="btn" onclick="showScreen('adminRekap')">Rekap Nilai</button>
    <button class="btn" onclick="showScreen('adminAbsensi')">Cek Absensi Siswa</button>
    <button class="btn" onclick="goLogin()">Kembali</button>
</div>

<!-- REKAP NILAI -->
<div id="adminRekap" class="screen">
    <h3 style="text-align:center;">REKAP NILAI</h3>
    <div id="rekapWrapper" style="max-height:500px; overflow-y:auto; padding-right:5px;"></div>
    <button class="btn-danger btn" onclick="resetData()">Reset Semua Data</button>
    <button class="btn" onclick="showScreen('adminMenu')">Kembali</button>
</div>

<!-- ABSENSI -->
<div id="adminAbsensi" class="screen">
    <h3 style="text-align:center;">ABSENSI SISWA</h3>
    <div id="absenWrapper" style="max-height:500px; overflow-y:auto; padding-right:5px;"></div>
    <button class="btn-danger btn" onclick="resetAbsensi()">Reset Absensi</button>
    <button class="btn" onclick="showScreen('adminMenu')">Kembali</button>
</div>

<script>
/********** SOAL KELAS 3 **********/
const pool3=[/* (soal kelas 3 yang sebelumnya, sama persis seperti versi kamu) */];

/********** SOAL KELAS 4 **********/
const pool4=[/* (soal kelas 4 yang sebelumnya, sama persis seperti versi kamu) */];

/********** STATE **********/
let current=[],index=0,score=0,student="",kelas="";
const synth=window.speechSynthesis;

/********** FUNCTION START QUIZ **********/
function startQuiz(){
    const n=document.getElementById("studentName").value.trim();
    const k=document.getElementById("studentClass").value;
    const err=document.getElementById("loginError");

    if(!n||!k){err.innerText="Harap isi nama & kelas";err.style.display="block";return;}

    // ABSENSI otomatis
    let hadir = JSON.parse(localStorage.getItem("absensi")||"[]");
    if(!hadir.some(x=>x.name==n && x.class==k)){
        hadir.push({name:n,class:k,time:new Date().toLocaleString("id-ID")});
        localStorage.setItem("absensi",JSON.stringify(hadir));
    }

    // CEK ULANG KUIS
    const history=JSON.parse(localStorage.getItem("quizHistory")||"[]");
    if(history.some(x=>x.name==n && x.class==k)){
        err.innerText="Siswa ini sudah mengerjakan!";
        err.style.display="block";
        return;
    }

    student=n; kelas=k;
    const pool=(k=="3A"||k=="3B")?pool3:pool4;
    current=shuffle([...pool]).slice(0,10);
    index=0; score=0;

    document.getElementById("kelasTag").innerText="Kelas "+k;
    showQuestion();
    showScreen("quiz");
}

/********** SHOW QUESTION **********/
function showQuestion(){
    const q=current[index];
    document.getElementById("progress").innerText=`Soal ${index+1}/10`;
    document.getElementById("questionText").innerText=q.q;
    speak(q.q);

    const opt=document.getElementById("options");
    opt.innerHTML="";
    document.getElementById("nextBtn").disabled=true;

    q.opts.forEach((o,i)=>{
        const div=document.createElement("div");
        div.className="option";
        div.innerText=o;
        div.onclick=()=>select(i,div);
        opt.appendChild(div);
    });
}

/********** SELECT ANSWER **********/
function select(i,el){
    document.querySelectorAll(".option").forEach(e=>e.classList.remove("selected"));
    el.classList.add("selected");
    el.setAttribute("data-choice",i);
    document.getElementById("nextBtn").disabled=false;
}

/********** NEXT **********/
function nextQuestion(){
    const choice=document.querySelector(".option.selected").getAttribute("data-choice");
    if(choice==current[index].a)score+=10;
    index++;
    if(index<current.length)showQuestion();
    else finish();
}

/********** FINISH **********/
function finish(){
    document.getElementById("nameResult").innerText=student;
    document.getElementById("scoreBox").innerText=score;

    const history=JSON.parse(localStorage.getItem("quizHistory")||"[]");
    history.push({name:student,class:kelas,score:score,time:new Date().toLocaleString("id-ID")});
    localStorage.setItem("quizHistory",JSON.stringify(history));

    showScreen("result");
}

/********** SPEECH **********/
function speak(text){
    synth.cancel();
    const u=new SpeechSynthesisUtterance(text);
    u.lang="id-ID"; u.rate=0.9;
    synth.speak(u);
}

/********** ADMIN **********/
function openAdmin(){
    const pwd=prompt("Masukkan sandi guru:");
    if(pwd==="040698"){showScreen("adminMenu");}
    else if(pwd!==null)alert("Sandi salah!");
}

function loadTable(){
    const wrapper=document.getElementById("rekapWrapper");
    const history=JSON.parse(localStorage.getItem("quizHistory")||"[]");
    wrapper.innerHTML="";

    const kelasList=["3A","3B","4A","4B"];
    kelasList.forEach(kls=>{
        const dataKelas=history.filter(x=>x.class===kls);
        if(dataKelas.length===0)return;

        wrapper.innerHTML+=`<h3 style="margin-top:15px;color:var(--primary);font-size:1.1rem;">Kelas ${kls}</h3>`;

        let html=`
        <table>
            <thead><tr><th>No</th><th>Nama</th><th>Nilai</th><th>Waktu</th></tr></thead>
            <tbody>
        `;
        dataKelas.forEach((x,i)=>{
            html+=`<tr><td>${i+1}</td><td>${x.name}</td><td>${x.score}</td><td>${x.time}</td></tr>`;
        });
        html+=`</tbody></table>`;
        wrapper.innerHTML+=html;
    });
    showScreen("adminRekap");
}

/********** ABSENSI **********/
function loadAbsensi(){
    const wrap=document.getElementById("absenWrapper");
    const data=JSON.parse(localStorage.getItem("absensi")||"[]");
    wrap.innerHTML="";

    const kelasList=["3A","3B","4A","4B"];
    kelasList.forEach(kls=>{
        const dataKelas=data.filter(x=>x.class===kls);
        if(dataKelas.length===0)return;

        wrap.innerHTML+=`<h3 style="margin-top:15px;color:var(--primary);font-size:1.1rem;">Kelas ${kls}</h3>`;

        let html=`
        <table>
            <thead><tr><th>No</th><th>Nama</th><th>Waktu Hadir</th></tr></thead>
            <tbody>
        `;
        dataKelas.forEach((x,i)=>{
            html+=`<tr><td>${i+1}</td><td>${x.name}</td><td>${x.time}</td></tr>`;
        });
        html+=`</tbody></table>`;
        wrap.innerHTML+=html;
    });

    showScreen("adminAbsensi");
}

/********** RESET DATA **********/
function resetData(){
    if(confirm("Yakin reset nilai?")){
        localStorage.removeItem("quizHistory");
        loadTable();
    }
}

function resetAbsensi(){
    if(confirm("Yakin reset absensi?")){
        localStorage.removeItem("absensi");
        loadAbsensi();
    }
}

/********** UTIL **********/
function restart(){location.reload();}
function goLogin(){showScreen("login");}
function showScreen(id){
    document.querySelectorAll(".screen").forEach(s=>s.classList.remove("active"));
    document.getElementById(id).classList.add("active");
}
function shuffle(a){for(let i=a.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[a[i],a[j]]=[a[j],a[i]];}return a;}
</script>

</div>
</body>
</html>
